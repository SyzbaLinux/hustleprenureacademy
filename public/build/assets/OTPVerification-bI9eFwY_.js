import{d as B,p as x,x as C,A as E,g as b,F as $,r as j,o as m,u as I,B as K,c as L,w as R,b as D,a,t as S,n as F,j as k,h as M,e as h}from"./app-DmVVAfp2.js";import{u as U,G as W}from"./GuestLayout-DdlEmWOu.js";import{A as q,a as G}from"./AuthButton-BkOK6xyO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"flex gap-3 justify-center"},X=["value","disabled","onInput","onKeydown"],z=B({__name:"OTPCodeInput",props:{modelValue:{default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","complete"],setup(T,{expose:n,emit:_}){const g=T,o=_,i=x(Array(6).fill("")),r=x([]),f=C(()=>i.value.join(""));C(()=>f.value.length===6&&f.value.every(e=>e!=="")),E(()=>g.modelValue,e=>{e&&e.length<=6&&(i.value=e.split("").concat(Array(6).fill("").slice(e.length)))}),E(f,e=>{o("update:modelValue",e),e.length===6&&o("complete",e)});const v=(e,p)=>{let l=p.target.value.replace(/[^0-9]/g,"");l.length>1&&(l=l.substring(0,1)),i.value[e]=l,l&&e<5&&setTimeout(()=>{var c;(c=r.value[e+1])==null||c.focus()},0)},w=(e,p)=>{var d,l,c;p.key==="Backspace"?(p.preventDefault(),i.value[e]?i.value[e]="":e>0&&(i.value[e-1]="",(d=r.value[e-1])==null||d.focus())):p.key==="ArrowLeft"&&e>0?(p.preventDefault(),(l=r.value[e-1])==null||l.focus()):p.key==="ArrowRight"&&e<5&&(p.preventDefault(),(c=r.value[e+1])==null||c.focus())},A=e=>{var l,c,s;e.preventDefault();const d=(((l=e.clipboardData)==null?void 0:l.getData("text"))||"").replace(/[^0-9]/g,"").substring(0,6).split("");i.value=d.concat(Array(6).fill("").slice(d.length)),d.length===6?(c=r.value[5])==null||c.blur():d.length>0&&((s=r.value[Math.min(d.length,5)])==null||s.focus())};return n({clear:()=>{var e;i.value=Array(6).fill(""),(e=r.value[0])==null||e.focus()}}),(e,p)=>(m(),b("div",J,[(m(!0),b($,null,j(i.value,(d,l)=>(m(),b("input",{ref_for:!0,ref_key:"refs",ref:r,key:l,value:d,type:"text",inputmode:"numeric",maxlength:"1",disabled:T.disabled,class:"w-14 h-14 text-center text-2xl font-bold rounded-lg border-2 border-emerald-200 focus:border-emerald-500 focus:outline-none transition-colors bg-white dark:bg-slate-800 dark:border-slate-600 dark:focus:border-emerald-400",onInput:c=>v(l,c),onKeydown:c=>w(l,c),onPaste:A},null,40,X))),128))]))}}),Y={class:"space-y-6"},H={class:"text-center"},Q={class:"text-lg font-semibold text-slate-900 dark:text-white mt-1"},Z={class:"flex gap-2"},ee=["onClick","disabled"],te={class:"space-y-4"},se={key:0,class:"text-center text-sm text-red-600 dark:text-red-400"},ae={key:0},oe={key:1},le={class:"text-center"},re={key:0,disabled:"",class:"text-sm font-medium text-slate-400 dark:text-slate-500"},ne={class:"font-bold"},ie=["disabled"],de={key:0},ce={key:1},ve=B({__name:"OTPVerification",props:{phoneNumber:{},email:{},method:{},contact:{}},setup(T){const n=T,{showSuccess:_,showError:g}=U(),o=I({code:"",contact:n.contact}),i=x(),r=x(600),f=x(!1),v=x(n.method==="email"?"email":n.method==="sms"?"sms":"whatsapp"),w=[{id:"whatsapp",name:"WhatsApp",icon:"fab fa-whatsapp",description:"Receive OTP via WhatsApp"},{id:"sms",name:"SMS",icon:"fas fa-sms",description:"Receive OTP via SMS"},{id:"email",name:"Email",icon:"fas fa-envelope",description:"Receive OTP via Email"}],A=C(()=>n.phoneNumber?n.phoneNumber:n.email?n.email:n.contact),N=C(()=>{const s=Math.floor(r.value/60),t=r.value%60;return`${s}:${t.toString().padStart(2,"0")}`}),e=C(()=>r.value===0);K(()=>{const s=setInterval(()=>{r.value>0?r.value--:clearInterval(s)},1e3)});const p=s=>{o.code=s,d()},d=()=>{o.post(route("otp.verify"),{preserveScroll:!0,onSuccess:()=>{_("OTP verified successfully! Logging you in...")},onError:()=>{var s;(s=i.value)==null||s.clear(),o.errors.code?g(o.errors.code):g("Verification failed. Please try again.")}})},l=async()=>{var s,t,u;f.value=!0;try{const y=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"),P=await(await fetch(route("otp.resend"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":y||""},body:JSON.stringify({method:v.value,contact:n.contact})})).json();P.success?(_(`OTP sent via ${v.value==="email"?"Email":v.value.toUpperCase()}!`),r.value=((t=P.data)==null?void 0:t.expires_in_seconds)||600,(u=i.value)==null||u.clear(),o.reset("code")):g(P.message||"Failed to resend OTP")}catch{g("Failed to resend OTP. Please try again.")}finally{f.value=!1}},c=async s=>{var t,u,y;if(s!==v.value){v.value=s,f.value=!0;try{const V=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"),O=await(await fetch(route("otp.send"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":V||""},body:JSON.stringify({method:s,contact:n.contact})})).json();O.success?(_(`OTP sent via ${s==="email"?"Email":s.toUpperCase()}!`),r.value=((u=O.data)==null?void 0:u.expires_in_seconds)||600,(y=i.value)==null||y.clear(),o.reset("code")):(v.value=n.method,g(O.message||`Failed to send OTP via ${s}`))}catch{v.value=n.method,g("Failed to switch method. Please try again.")}finally{f.value=!1}}};return(s,t)=>(m(),L(W,null,{default:R(()=>[D(q,{title:"Verify Your Identity",subtitle:"Enter the verification code we sent"},{default:R(()=>[a("div",Y,[a("div",H,[t[1]||(t[1]=a("p",{class:"text-sm text-slate-600 dark:text-slate-400"}," Verification code sent to ",-1)),a("p",Q,S(A.value),1)]),a("div",Z,[(m(),b($,null,j(w,u=>a("button",{key:u.id,onClick:y=>c(u.id),disabled:f.value,class:F(["flex-1 py-3 px-3 rounded-lg border-2 transition-colors text-center text-sm font-medium",{"border-[#e0156b] bg-pink-50 dark:bg-[#b30d4f]/20 text-[#b30d4f] dark:text-[#e0156b]":v.value===u.id,"border-slate-200 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:border-slate-300 dark:hover:border-slate-500":v.value!==u.id,"opacity-50 cursor-not-allowed":f.value}])},[a("i",{class:F([u.icon,"mr-1"])},null,2),k(" "+S(u.name),1)],10,ee)),64))]),a("div",te,[t[3]||(t[3]=a("p",{class:"text-center text-sm text-slate-600 dark:text-slate-400"}," Enter the 6-digit code below ",-1)),D(z,{ref_key:"otpCodeRef",ref:i,modelValue:h(o).code,"onUpdate:modelValue":t[0]||(t[0]=u=>h(o).code=u),disabled:h(o).processing,onComplete:p},null,8,["modelValue","disabled"]),h(o).errors.code?(m(),b("div",se,[t[2]||(t[2]=a("i",{class:"fas fa-exclamation-circle mr-1"},null,-1)),k(" "+S(h(o).errors.code),1)])):M("",!0)]),D(G,{onClick:d,disabled:h(o).code.length!==6||h(o).processing,class:"w-full"},{default:R(()=>[h(o).processing?(m(),b("span",oe,[...t[4]||(t[4]=[a("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1),k("Verifying...",-1)])])):(m(),b("span",ae,"Verify Code"))]),_:1},8,["disabled"]),a("div",le,[t[7]||(t[7]=a("p",{class:"text-sm text-slate-600 dark:text-slate-400 mb-2"}," Didn't receive the code? ",-1)),e.value?(m(),b("button",{key:1,onClick:l,disabled:f.value,class:"text-sm font-medium text-[#b30d4f] dark:text-[#e0156b] hover:text-[#8b0a3d] dark:hover:text-[#b30d4f] transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[f.value?(m(),b("span",ce,[...t[6]||(t[6]=[a("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),k("Sending...",-1)])])):(m(),b("span",de,"Resend Code"))],8,ie)):(m(),b("button",re,[t[5]||(t[5]=k(" Resend in ",-1)),a("span",ne,S(N.value),1)]))]),t[8]||(t[8]=a("div",{class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},[a("p",{class:"text-sm text-blue-800 dark:text-blue-300"},[a("i",{class:"fas fa-lock mr-2"}),k(" Never share this code. We'll never ask you for it via email or phone. ")])],-1)),t[9]||(t[9]=a("div",{class:"text-center"},[a("p",{class:"text-sm text-slate-600 dark:text-slate-400"},[a("a",{href:"/login",class:"font-medium text-[#b30d4f] dark:text-[#e0156b] hover:underline"}," Back to login ")])],-1))])]),_:1})]),_:1}))}});export{ve as default};
